# 更新日志

本项目的所有重要更改都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
并且本项目遵循 [语义化版本控制](https://semver.org/lang/zh-CN/spec/v2.0.0.html)。

## [2.3.0] - 2024-12-07

### 重大版本更新 (Major Release)
本版本是 TL-Rustscan 的一个重要里程碑，专注于性能优化、代码重构和开源准备。

### 新增
- **代理支持**: 新增 `--proxy` 参数，支持 SOCKS5 代理（如 `socks5://127.0.0.1:1080`），覆盖 TCP 连接、TLS 握手及 HTTP/Web 探测。
- **UDP 扫描增强**: 为 DNS, NTP, SNMP, NetBIOS, SSDP 等协议添加了专用探测载荷，并支持 Banner 解析，大幅提升 UDP 端口识别率。
- **日志轮转**: 实现了按日轮转的日志记录机制 (`rustscan.log.YYYY-MM-DD`)，便于长期运行维护。
- **错误统计**: 扫描结束后输出详细的错误统计摘要（超时、连接拒绝等），辅助网络诊断。
- **自适应并发控制**: 根据网络状况动态调整并发数，提升扫描效率。
- **连接池健康检查**: 优化 TCP 连接复用机制，减少资源占用。
- **指纹识别并行化**: 提升指纹匹配速度。
- **完善的文档体系**: 新增 API、架构、安全等详细文档。

### 优化
- **代码重构**: 全面清理代码库，移除冗余代码和注释。
- **项目结构**: 规范化项目目录结构，符合开源标准。
- **构建系统**: 优化构建脚本，移除不必要的构建产物。

### 修复
- 修复了 UDP 扫描在某些情况下无法正确解析返回包的问题。
- 修复了 Windows 环境下 TCP 连接可能误报为 Filtered 的问题。

## [1.2.2] - 2025-11-28

### 性能与控制增强 (Performance & Control)
本次更新主要增强了用户对扫描流程的控制能力，并修复了在极端场景下的内存安全问题。

### 新增
- **跳过复查 (`-x` / `--no-retry`)**: 新增了 `-x` 参数，允许用户显式关闭“智能复查”机制。
  - 默认情况下，工具会自动对超时或被过滤的端口进行二次复查以提高准确性。
  - 在追求极致速度或网络环境非常稳定的场景下，使用 `-x` 可以跳过此步骤，直接进入插件扫描阶段。

### 修复
- **OOM 深度防护**: 
  - 修复了 Web 漏洞扫描插件 (WebLogic, CouchDB, Hikvision 等) 在读取超大响应体时可能导致的内存溢出 (OOM) 问题，统一实施了 1MB 的读取上限。
  - 修复了 HTML 报告生成逻辑，改用流式写入，防止在扫描数万个目标时因构建巨大字符串而耗尽内存。
- **安全加固**:
  - 修复了 CSV 报告生成时的 CSV 注入 (CSV Injection) 风险，对所有字段进行了转义处理。
  - 修复了端口解析逻辑中的 "Double Port" (重复端口) Bug。

## [1.2.1] - 2025-11-26

### 紧急修复与健壮性提升 (Critical Fixes & Robustness)
本次更新是在 1.2.0 版本基础上的紧急修复版本，重点解决了在深度代码审计中发现的多个潜在 Panic 风险和逻辑缺陷，并完善了对 IPv6 环境的支持。

### 修复
- **IPv6 全面支持**: 修复了 IPv6 地址在 TCP 连接和 URL 构造时的格式问题（自动添加 `[]` 包裹），现在所有插件（SSH, WebTitle, Redis 等）均可完美支持 IPv6 目标扫描。
- **RDP 插件越界读取**: 修复了 RDP 探测逻辑中潜在的数组越界读取 (Out-of-bounds Read) 风险，防止在接收到畸形数据包时导致程序崩溃。
- **正则引擎 ReDoS 防护**: 针对 WebTitle 插件中的正则表达式进行了优化，引入 `OnceLock` 缓存编译结果，并修复了潜在的 ReDoS (正则表达式拒绝服务) 风险。
- **FingerprintDB Panic**: 修复了指纹库加载时，如果正则编译失败直接 `unwrap()` 导致程序崩溃的问题，改为优雅降级处理。
- **SSH 插件 DNS 解析**: 修复了 SSH 插件仅支持 IP 地址不支持域名的问题，现在使用 `ToSocketAddrs` 进行标准 DNS 解析。
- **WebPoc 协议覆盖**: 修复了 Web 漏洞扫描插件在非标准端口（如 8080, 8443）上协议判断过于死板的问题，现在会自动尝试 HTTP 和 HTTPS 两种协议。
- **Oracle 插件整数溢出**: 修复了 Oracle TNS 数据包构建时潜在的 `u16` 整数溢出风险。

## [1.2.0] - 2025-11-26

### 红队全能模式 (Red Team / Intranet Penetration)
本次更新引入了重磅功能——**红队模式 (`--rscan`)**，标志着 TL-Rustscan 从单一的端口扫描器进化为全能的内网渗透工具。
该模式集成了类似 `fscan` 的核心能力，支持一键式弱口令爆破和高危漏洞检测。

### 新增
- **红队模式 (`--rscan` / `-r`)**: 一键开启内网渗透模式，自动执行弱口令爆破和漏洞扫描。
- **弱口令爆破模块**:
  - 支持 SSH, SMB, FTP, Telnet, MySQL, MSSQL, PostgreSQL, Redis, MongoDB, Tomcat 等服务的弱口令检测。
  - 内置精简高效的弱口令字典，支持针对性爆破。
- **高危漏洞/POC 模块**:
  - **Windows**: MS17-010 (永恒之蓝) 检测。
  - **WebLogic**: CVE-2017-10271, CVE-2019-2725, Console 弱口令检测。
  - **中间件/框架**: SpringBoot Actuator, Nacos, Docker Registry, PHPMyAdmin, CouchDB, Prometheus, Zookeeper, Elasticsearch 未授权访问检测。
  - **设备**: 海康威视 (Hikvision) 弱口令与漏洞检测。
  - **其他**: JDWP 远程调试漏洞, FCGI 未授权访问, VNC/LDAP 未授权访问。
- **信息收集**:
  - NetBIOS 主机名获取。
  - SNMP 团体名爆破与系统信息获取。
  - Oracle TNS Listener 探测。
- **控制参数**:
  - `--no-brute`: 红队模式下禁用爆破，仅进行漏洞扫描。
  - `--no-poc`: 红队模式下禁用漏洞验证，仅进行爆破。

### 优化
- **插件化架构**: 重构了扫描核心，将所有探测功能插件化，便于后续扩展。
- **智能调度**: 红队模式下的插件仅在端口开放且服务指纹匹配时触发，极大提高了扫描效率并降低了对目标的干扰。

## [1.1.1] - 2025-11-25

### 核心架构升级 (Precision & Stability)
本次更新重点针对**扫描精准度**和**底层稳定性**进行了深度审计与重构，解决了多个长期存在的边界情况误报问题。

### 新增
- **Favicon 指纹识别**: 新增了基于 Favicon Hash (Murmur3) 的指纹识别功能。
  - 实现了标准的 Base64 分块 (MIME 76字符换行) 处理逻辑，与 Shodan 算法保持一致。
  - 支持通过网站图标精确识别特定应用 (如致远 OA, Spring Boot 等)。
- **指纹库扩充**: 新增了 Seeyon OA 等高价值指纹规则。
- **字典库升级**: 内置 Web 目录爆破字典大幅扩充至 300,000+ 条，涵盖常见备份文件、后台路径、敏感信息泄露路径等。
- **智能协议识别 (Smart Protocol Handshake)**: 新增了 RTSP, SOCKS5, MQTT, AMQP 等协议的主动探测与识别能力，在无 Banner 响应时自动触发。
- **上下文感知爆破 (Context-Aware Fuzzing)**: Web 目录扫描现在会根据识别到的指纹（如 Spring Boot, PHP, Tomcat）自动加载特定的敏感路径（如 `/actuator`, `/info.php`）。
- **TLS 深度解析**: 支持提取 TLS 证书的 Subject, Issuer 以及 SANs (Subject Alternative Names) 信息，辅助发现隐藏域名。
- **UDP 扫描增强**: 新增 Citrix ICA (1604) 和 IPMI (623) 协议的 UDP 探测载荷。

### 修复与优化
- **Web 目录扫描防误报 (Soft 404 Detection)**: 
  - **Chunked Encoding 支持**: 修复了当服务器使用 Chunked 传输编码（无 Content-Length 头）时，Soft 404 检测失效的问题。现在会自动读取响应体（限制 1MB）来计算实际长度。
  - 修复了在遇到配置了“泛解析”或“自定义 404 页面（返回 200 OK）”的服务器时，目录扫描会报告所有路径存在的严重 Bug。
  - 实现了基准测试逻辑：扫描前先请求随机路径，记录响应特征（状态码、长度），并在后续扫描中自动过滤与之相似的响应。
- **协议探测健壮性 (Probe Robustness)**:
  - **智能碎片重组**: 重构了所有主动探测逻辑（Redis, MySQL, SSH 等），引入了 `read_with_timeout` 机制。
  - 解决了在慢速网络或高延迟环境下，因 TCP 数据包分片导致的 Banner 截断或识别失败问题。
- **Windows 平台稳定性**:
  - **异步连接优化**: 针对 Windows 内核 Socket 限制，重构了 TCP 连接模块，使用 `spawn_blocking` 隔离连接操作，彻底解决了高并发下的 `OS Error 10055` 和连接假死问题。
- **正则引擎安全加固 (Regex Safety)**: 
  - 修复了指纹库加载时可能存在的 ReDoS (正则表达式拒绝服务) 风险。
  - 引入 `RegexBuilder` 强制开启大小写不敏感，并设置了 10MB 的编译大小限制，防止恶意或复杂的正则导致内存耗尽。
- **扫描结果净化 (Result Purification)**: 
  - 实现了智能过滤机制，自动屏蔽 "Nginx", "Wappalyzer Technology Detection", "Kubelet Healthz" 等通用或无意义的噪音指纹。
  - 过滤了 "default", "ok", "admin" 等低价值关键词匹配，使输出更加清爽精准。
- **指纹匹配逻辑**: 优化了指纹匹配流程，优先展示高价值指纹。

## [1.1.0] - 2025-11-24

### 新增
- **指纹库大幅扩充**: 导入了 12,000+ 条新的 Web 指纹规则，总指纹数突破 16,000+，大幅提升了对各类 CMS、OA 和中间件的识别能力。
- **指纹导入工具**: 新增 `scripts/import_fingerprints.py` 脚本，支持将 Finger/Ehole 等格式的自定义指纹库合并到系统内置指纹库中，并自动处理格式转换和去重。
- **WAF 识别**: 自动检测 Cloudflare, Aliyun, AWS, F5 等 WAF。
- **随机 User-Agent**: 支持 `--random-ua` 参数以规避特征检测。
- **外部指纹库**: 支持 `--fingerprints` 参数加载自定义 JSON 指纹库。
- **指纹库管理**: 支持自动加载当前目录的 `fingerprints.json`，并支持通过 `--dump-json` 导出内置指纹库。

### 修复与优化
- **深度代码审计修复**:
  - **HTTPS 重定向**: 修复了 HTTPS 环境下重定向被忽略的严重 Bug。
  - **相对路径重定向**: 新增了对相对路径重定向 (如 `/login`) 的支持。
  - **性能优化**: 优化了指纹库匹配算法 (预计算小写)，大幅降低 CPU 占用。
  - **资源优化**: 重构了 HTTP 客户端管理，复用 Client 实例，大幅降低内存占用和句柄消耗。
  - **逻辑一致性**: 修复了 User-Agent 在探测过程中不一致的问题。
- **核心逻辑修复**:
  - **指纹识别**: 修复了指纹库正则大小写敏感导致的漏报问题 (如 `Server: Apache` vs `apache`)，现在所有正则强制不区分大小写。
  - **HTTP 重定向**: 修复了 HTTP 重定向跟随逻辑缺失的问题，现在可以正确获取跳转后的页面指纹。
- **性能优化**:
  - **Web 目录扫描并发**: 将目录爆破从串行改为并发执行，大幅提升扫描速度。
  - **指纹匹配算法重构**: 引入 Aho-Corasick 算法，将指纹匹配复杂度从 O(N*M) 降低到 O(N+M)，极大提升了拥有海量指纹时的扫描速度。
  - 修复了高并发下的 TCP 端口耗尽 (EADDRNOTAVAIL) 问题，增加了指数退避重试机制。
  - 修复了高并发下的 UDP Socket 绑定耗尽 (EMFILE) 问题。
  - **UDP 扫描健壮性**: 修复了 UDP 扫描在网络抖动时的重试逻辑，增加了退避等待机制。
  - **URL 解析增强**: 引入标准 `url` 库处理 HTTP 重定向，修复了相对路径和复杂 URL 解析的脆弱性。
- **安全性修复**:
  - 修复了 HTML 报告中的 XSS 漏洞 (对输出内容进行了 HTML 实体转义)。
  - 修复了 CSV 注入 (Formula Injection) 漏洞。
  - 增强了 Banner 清洗逻辑，过滤终端控制字符以防止显示混乱。
- **稳定性修复**:
  - 修复了 UDP 发包缓冲区溢出 (ENOBUFS) 问题。
  - 修复了 RST 扫描模式下的 Panic 风险 (移除 unwrap)。
- **功能增强**:
  - **Web 指纹识别**: 修复了非标准 Banner (如 JBoss) 导致 Web 指纹漏扫的问题，增强了触发逻辑。
  - 重构了 UDP 扫描逻辑，支持无连接模式接收响应，解决了多宿主环境下的漏报问题。
  - 修复了 UDP 扫描在 IPv6 环境下的绑定错误 (自动适配 `[::]:0`)。
  - 修复了 UDP 扫描的源地址验证逻辑，防止误报。
  - 优化了主机存活检测 (Host Discovery)，支持资源耗尽时的重试。
  - 修复了 IPv6 目标的 HTTP Host Header 格式问题。
  - 增加了端口范围配置的逻辑校验。
  - 优化了目标解析逻辑，支持基于 (IP, Host) 的虚拟主机去重扫描。
  - 完善了 CSV 输出格式，符合 RFC 4180 标准。

## [1.0.0] - 2025-11-23

### 新增
- **指纹库扩充**: 集成 Wappalyzer, Nuclei, Recog 规则，指纹总数达到 4200+，并修复了所有 Rust 正则兼容性问题。
- **WAF 识别**: 自动检测 Cloudflare, Aliyun, AWS, F5 等 WAF。
- **随机 User-Agent**: 支持 `--random-ua` 参数以规避特征检测。
- **外部指纹库**: 支持 `--fingerprints` 参数加载自定义 JSON 指纹库。
- **指纹库管理**: 支持自动加载当前目录的 `fingerprints.json`，并支持通过 `--dump-json` 导出内置指纹库。

### 修复与优化
- **深度代码审计修复**:
  - **HTTPS 重定向**: 修复了 HTTPS 环境下重定向被忽略的严重 Bug。
  - **相对路径重定向**: 新增了对相对路径重定向 (如 `/login`) 的支持。
  - **性能优化**: 优化了指纹库匹配算法 (预计算小写)，大幅降低 CPU 占用。
  - **资源优化**: 重构了 HTTP 客户端管理，复用 Client 实例，大幅降低内存占用和句柄消耗。
  - **逻辑一致性**: 修复了 User-Agent 在探测过程中不一致的问题。
- **核心逻辑修复**:
  - **指纹识别**: 修复了指纹库正则大小写敏感导致的漏报问题 (如 `Server: Apache` vs `apache`)，现在所有正则强制不区分大小写。
  - **HTTP 重定向**: 修复了 HTTP 重定向跟随逻辑缺失的问题，现在可以正确获取跳转后的页面指纹。
- **性能优化**:
  - **Web 目录扫描并发**: 将目录爆破从串行改为并发执行，大幅提升扫描速度。
  - 修复了高并发下的 TCP 端口耗尽 (EADDRNOTAVAIL) 问题，增加了指数退避重试机制。
  - 修复了高并发下的 UDP Socket 绑定耗尽 (EMFILE) 问题。
  - **指纹匹配算法重构**: 引入 Aho-Corasick 算法，将指纹匹配复杂度从 O(N*M) 降低到 O(N+M)，极大提升了拥有海量指纹时的扫描速度。
  - **UDP 扫描健壮性**: 修复了 UDP 扫描在网络抖动时的重试逻辑，增加了退避等待机制。
  - **URL 解析增强**: 引入标准 `url` 库处理 HTTP 重定向，修复了相对路径和复杂 URL 解析的脆弱性。
- **安全性修复**:
  - 修复了 HTML 报告中的 XSS 漏洞 (对输出内容进行了 HTML 实体转义)。
  - 修复了 CSV 注入 (Formula Injection) 漏洞。
  - 增强了 Banner 清洗逻辑，过滤终端控制字符以防止显示混乱。
- **稳定性修复**:
  - 修复了 UDP 发包缓冲区溢出 (ENOBUFS) 问题。
  - 修复了 RST 扫描模式下的 Panic 风险 (移除 unwrap)。
- **功能增强**:
  - **Web 指纹识别**: 修复了非标准 Banner (如 JBoss) 导致 Web 指纹漏扫的问题，增强了触发逻辑。
  - 重构了 UDP 扫描逻辑，支持无连接模式接收响应，解决了多宿主环境下的漏报问题。
  - 修复了 UDP 扫描在 IPv6 环境下的绑定错误 (自动适配 `[::]:0`)。
  - 修复了 UDP 扫描的源地址验证逻辑，防止误报。
  - 优化了主机存活检测 (Host Discovery)，支持资源耗尽时的重试。
  - 修复了 IPv6 目标的 HTTP Host Header 格式问题。
  - 增加了端口范围配置的逻辑校验。
  - 优化了目标解析逻辑，支持基于 (IP, Host) 的虚拟主机去重扫描。
  - 完善了 CSV 输出格式，符合 RFC 4180 标准。

## [0.1.0] - 2024-01-08

### 新增
- TL-Rustscan 初始版本发布。
- 基于 Tokio 的高性能异步端口扫描。
- 支持 TCP Connect 扫描模式。
- 支持多种服务指纹识别：SSH, MySQL, Redis, MongoDB, MSSQL, Oracle 等。
- Web 框架指纹识别 (Spring Boot, Vue, Laravel 等)。
- 深度扫描模式 (Deep Scan)，支持 API 主动探测 (如 RuoYi)。
- Web 目录爆破功能。
- 智能协议回退机制 (HTTP/TLS)。
- 支持 CIDR、域名和文件导入目标。
- 支持 JSON, Markdown, CSV 和 HTML 输出格式。
- 跨平台支持 (Windows, Linux, macOS)。
